<!DOCTYPE html>
{% load static %}
{% load dict_extras %}
{% load notifications_tags %}
<html lang="ja">
    <head>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-G08GZPEB1K"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-G08GZPEB1K');
        </script>

        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <!-- pinch in out -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes">
        <title>Local Things Home</title>
        <meta name="description" content="{% block description %}Local Things„ÅØ„ÄÅÂ§ßÂàÜÁúå„ÅÆÂú∞Âüü„ÅÆ„Äå‰ΩïÊ∞ó„Å™„ÅÑ„ÇÇ„ÅÆ„Äç„ÇíÁ¥π‰ªã„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
            „É≠„Éº„Ç´„É´„Éï„Éº„Éâ„ÇÑ„ÄÅ„É≠„Éº„Ç´„É´„Çπ„Éù„ÉÉ„Éà„ÄÅ„Éä„Ç§„Çπ„Å™„Åä„Çπ„Çπ„É°ÊÉÖÂ†±„Å™„Å©„ÄÇ
            Â§ßÂàÜ„ÅÆLocal„ÅåÂ•Ω„Åç„Å™‰∫∫„ÄÅËààÂë≥„Åå„ÅÇ„Çã‰∫∫„Å®„ÅßÂú∞Âüü„ÇíÁõõ„Çä‰∏ä„Åí„Å¶„ÅÑ„ÅèÂú∞ÂüüÂØÜÁùÄÂûãÂõΩÁî£SNS{% endblock %}"/>
        <!--  favicon  -->
        <link rel="icon" href="{% static 'favicon.ico' %}">
        <!-- PWA -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-title" content="Local Things">
        <link href="/static/apple-touch-icon.png" sizes="180x180" rel="apple-touch-icon">
        <meta name="theme-color" content="white">
        <link rel="manifest" href="{% static 'manifest.json' %}">
        <!--  Google Search Console   -->
        <meta name="google-site-verification" content="pzDQnHiXAF6b76qLuGcsnt2Fg9p3PPVooCxmn4QJsKw" />
        <!-- pinch in out -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes">
        <!--  Font Awesome      -->
        <script src="https://kit.fontawesome.com/893f850b11.js" crossorigin="anonymous"></script>
        <!--  Google Fonts      -->
        <link href="https://fonts.googleapis.com/css2?family=Baloo+Paaji+2&display=swap" rel="stylesheet">
        <!-- Swiper CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
        <!--  Load CSS  -->
        <link rel="stylesheet" href="{% static 'css/main.css' %}">
        <meta name="csrf-token" content="{{ csrf_token }}">
    </head>
    <body>
        <header id="nav" class="mobile-nav-wrapper">
            <div class="mobile-nav-top-link">
                {% if user.is_authenticated %}
                <a href="{% url 'articles:users_detail' user.pk %}">
                    <div class="mobile-profile-container">
                        <img src="{{ user.profile.image.url }}" class="profile-pic" alt="Avatar" loading="lazy">
                    </div>
                </a>
                {% else %}
                <div class="mobile-profile-container">
                    <i class="far fa-user-circle"></i>
                </div>
                {% endif %}
            </div>
            <div class="mobile-nav-top-link">
                <a href="{% url 'about' %}">
                    <div class="mobile-wrapper_circle">
                        <h1 class="mobile-logo_1">L</h1><h1 class="mobile-logo_2">T</h1>
                    </div>
                </a>
            </div>
        </header>
        <!-- Left -->
        <div class="container">
            <div class="left">
                <div class="left-icons-wrapper">
                    <ul>
                        <li class="logo">
                            <div class="wrapper_circle">
                                <a href="{% url 'about' %}">
                                    <h1 class="logo_1">L</h1><h1 class="logo_2">T</h1>
                                </a>
                            </div>
                        </li>
                        <li class="icon-item">
                            <a href="{% url 'home' %}" class="icon-link">
                                <div class="icon-wrapper">
                                    <i class="fa fa-home"></i>
                                </div>
                                <span class="icon-label-text">„Éõ„Éº„É†</span>
                            </a>
                        </li>
                        <li class="icon-item">
                            <a href="{% url 'articles:article_search' %}" class="icon-link" id="search-btn">
                                <div class="icon-wrapper">
                                    <i class="fas fa-search"></i>
                                </div>
                                <span class="icon-label-text">Ê§úÁ¥¢</span>
                            </a>
                        </li>
                        <li class="icon-item">
                            <a href="{% url 'articles:gallery' %}" class="icon-link">
                                <div class="icon-wrapper">
                                    <i class="far fa-compass"></i>
                                </div>
                                <span class="icon-label-text">Áô∫Ë¶ã</span>
                            </a>
                        </li>

                        {% if user.is_authenticated %}
                            <li class="icon-item">
                                <a href="{% url 'articles:book_mark_list' %}" class="icon-link">
                                    <div class="icon-wrapper">
                                        <i class="far fa-bookmark"></i>
                                    </div>
                                    <span class="icon-label-text">„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ</span>
                                </a>
                            </li>
                            <li class="icon-item">
                                <a href="{% url 'accounts:user_following' %}" class="icon-link">
                                    <div class="icon-wrapper">
                                        <i class="fas fa-user-check user-checking"></i>
                                    </div>
                                    <span class="icon-label-text">„Éï„Ç©„É≠„Éº‰∏≠</span>
                                </a>
                            </li>
                            <li class="icon-item">
                                {% if user.is_authenticated %}
                                {% notifications_unread as unread_count %}
                                    <a href="{% url 'my_notifications' %}" class="icon-link">
                                        <div class="icon-wrapper">
                                            <i class="far fa-bell">
                                                {% if unread_count %}
                                                    <div class="number">
                                                        <small class="live_notify_badge">{% if unread_count > 0 %}{{ unread_count }}{% endif %}</small>
                                                    </div>
                                                {% endif %}
                                            </i>
                                        </div>
                                        <span class="icon-label-text">„ÅäÁü•„Çâ„Åõ</span>
                                    </a>
                                {% endif %}
                            </li>
                            <li class="icon-item">
                                <a href="{% url 'articles:create' %}" class="icon-link">
                                    <div class="icon-wrapper">
                                        <i class="fas fa-feather-alt"></i>
                                    </div>
                                    <span class="icon-label-text">ÊäïÁ®ø</span>
                                </a>
                            </li>
                            <li class="icon-item">
                                <a href="{% url 'articles:users_detail' user.pk %}" class="icon-link">
                                    <div class="icon-wrapper">
                                        <img src="{{ user.profile.image.url }}" class="left-profile-pic" alt="Avatar" loading="lazy">
                                    </div>
                                    <span class="icon-label-text">„Éó„É≠„Éï„Ç£„Éº„É´</span>
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                    <!-- üëá Ê§úÁ¥¢„Éú„ÉÉ„ÇØ„Çπ„ÇíÊåøÂÖ•„Åô„ÇãÂ∞ÇÁî®„Ç®„É™„Ç¢ -->
                    <div id="search-container" style="display: none;"></div>
                </div>
            </div>
            <!-- Right and Reft -->
            <div class="center-and-right">
                <!-- Center -->
                <div class="center" id="main">
                    <div class="center-header">
                        <div class="header-name">
                            <h3>„Éõ„Éº„É†</h3>
                        </div>
                        <div class="header-icon-circle">
                            <div class="header-icon">
                                <button id="darkModeToggle">
                                    <i class="fas fa-star-and-crescent"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="hero" id="clouds">
                        <div class="cloud top"></div>
                        <div class="cloud mid_1"></div>
                        <div class="cloud mid_2"></div>
                        <div class="cloud mid_3"></div>
                        <div class="cloud bottom"></div>
                        <div class="bird">..</div>
                        <div id="ufo">üõ∏</div>
                        <div class="title_wrapper">
                            <h1>Oita Local things</h1>
                        </div>
                        <div class="sub_title">
                            What's ordinary to one person 
                            <br>might be extraordinary to another.
                        </div>
                        {% if user.is_authenticated %}
                        <div class="global-footer"></div>
                        {% else %}
                        <div class="hero-btn">
                            <div class="hero-btn-word">„Åï„ÅÅ„ÄÅ„ÅØ„Åò„ÇÅ„Çà„ÅÜ</div>
                            <a href="{% url 'accounts:login' %}">Login</a>
                        </div>
                        {% endif %}
                    </div>
                    <div class="article-wrapper">
                        <article class="following-feed">
                            <!-- {# templates/articles/partial_article_card_list.html #} -->
                            {% for article in articles %}
                                {% include "articles/partial_article_card.html" with article=article %}
                            {% empty %}
                            <div class="global-tag">
                                <h3>„ÅäÊé¢„Åó„ÅÆÊ§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„ÅØË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ</h3>
                            </div>
                            {% endfor %}
                        </article>
                        <div id="loader">
                            {% include 'articles/snippet/spinner.html' %}
                            <p class="end-message" style="display: none;">„Åì„Çå‰ª•‰∏ä„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
                        </div>
                    </div>
                        <div class="global-footer"></div>
                </div>
                <!-- Right -->
                <div class="right">
                    <div class="right-wrapper">
                        <div class="favorite-articles">
                            <div class="favorite-title">
                                <span>„Åä„Åô„Åô„ÇÅ</span>
                            </div>
                            {% for favorite in order_like_articles %}
                            <div class="favorite-wrapper">
                                <div class="favorite-items">
                                    {% if favorite.category != None %}
                                    <span class="favorite-category">
                                        {{ favorite.category }}
                                    </span>
                                    {% endif %}
                                    <a href="{% url 'articles:detail' pk=favorite.pk %}">
                                        <span>{{ favorite.title | truncatechars_html:10 }}</span>
                                    </a>
                                </div>
                                <div class="favorite-thumb">
                                    {% if favorite.images.all %}
                                        {% with first_image=favorite.images.all.first %}
                                            {% if first_image %}
                                                <img src="{{ first_image.image.url }}" loading="lazy" alt="{{ favorite.title }}"/>
                                            {% endif %}
                                        {% endwith %}
                                    {% else %}
                                        <img src="/media/No-image.png" loading="lazy" alt="No image"/>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                            <div class="favorite-info">
                                <a href="{% url 'articles:ordered_by_likes' %}">
                                    <h5>„Åï„Çâ„Å´Ë¶ã„Çã</h5>
                                </a>
                            </div>
                        </div>
                        {% if user.is_authenticated %}
                        <div class="users">
                            <div class="favorite-title">
                                <span>Users</span>
                            </div>
                            {% for user in users %}
                            {% if request.user != user.user %}
                            <div class="users-wrapper">
                                <ul class="users-box">
                                    <li class="users-items">
                                        <a href="{% url 'accounts:profile_detail' user.user %}">
                                            <img src="{{ user.user.profile.image.url }}" alt="{{ user.user }}avatar">
                                        </a>
                                    </li>
                                    <li class="users-items">
                                        <span>{{ user.user }}</span>
                                    </li>
                                </ul>
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                        {% endif %}
                        <div class="web-info">
                            <a href="{% url 'about' %}">
                                <span>Âà©Áî®Ë¶èÁ¥Ñ</span>
                            </a>
                            <a href="{% url 'privacy-policy' %}">
                                <span>„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº</span>
                            </a>
                            <div class="copyright">
                                <p>
                                    <i class="far fa-copyright">2025 Local Things</i>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% if user.is_authenticated %}
        <div class="mobile-create-circle">
            <a href="{% url 'articles:create' %}">
                <i class="fa fa-plus"></i>
            </a>
        </div>
        {% endif %}
        <nav class="mobile-nav">
            <a href="#clouds" class="mobile-nav-link" id="scroll-top">
                <i class="fas fa-home mobile-nav-icon"></i>
            </a>
            <a href="{% url 'articles:gallery' %}" class="mobile-nav-link">
                <i class="far fa-compass mobile-nav-icon"></i>
            </a>
            {% notifications_unread as unread_count %}
            <a href="{% url 'my_notifications' %}" class="mobile-nav-link">
                <i class="far fa-bell mobile-nav-icon">
                    {% if unread_count %}
                    <div class="number">
                        <small class="live_notify_badge">{% if unread_count > 0 %}{{ unread_count }}{% endif %}</small>
                    </div>
                    {% endif %}
                </i>
            </a>
            <a href="{% url 'articles:book_mark_list' %}" class="mobile-nav-link">
                <i class="far fa-bookmark mobile-nav-icon"></i>
            </a>
            {% if user.is_authenticated %}
            <a href="{% url 'accounts:user_following' %}" class="mobile-nav-link">
                <i class="fas fa-user-check mobile-nav-icon"></i>
            </a>
            {% endif %}
        </nav>
        <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchBtn = document.querySelector('#search-btn');           // Ê§úÁ¥¢„Ç¢„Ç§„Ç≥„É≥
            const searchContainer = document.querySelector('#search-container'); // Ê§úÁ¥¢Áî®div
            let isSearchVisible = false;

            searchBtn.addEventListener('click', (e) => {
                e.preventDefault();

                if (!isSearchVisible) {
                    fetch("{% url 'articles:article_search_partial' %}")
                        .then(response => response.text())
                        .then(html => {
                            searchContainer.innerHTML = html;
                            searchContainer.style.display = 'block';
                            isSearchVisible = true;
                        })
                        .catch(error => console.error('Ê§úÁ¥¢„Éë„Éç„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', error));
                } else {
                    // Ê§úÁ¥¢„Éú„ÉÉ„ÇØ„Çπ„ÇíÊ∂à„Åô„Å†„ÅëÔºàmain„ÅÆÂÜÖÂÆπ„ÅØ„Åù„ÅÆ„Åæ„ÅæÔºâ
                    searchContainer.innerHTML = '';
                    searchContainer.style.display = 'none';
                    isSearchVisible = false;
                }
            });
        });
        </script>
        <script src="/static/js/scroll.js"></script>
        <script src="/static/js/mobile-create.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
        <script src="/static/js/swiper-images.js"></script>
        <script src="/static/js/app.js"></script>
        <script src="/static/js/mobile-hover.js"></script>
        <script src="/static/js/scroll-top.js"></script>
        <script src="/static/js/ufo.js"></script>
        <script src="/static/js/darkmode.js"></script>
        <script src="/static/js/mobile-nav-scroll.js"></script>
        <script src="/static/js/fulltext.js"></script>
        <script src="/static/js/main_comment_toggle.js"></script>
        <script src="/static/js/infinite_scroll.js"></script>
        <script src="/static/js/liked.js"></script>
        <script src="/static/js/book_mark.js"></script>
        <script src="/static/js/comment.js"></script>
    </body>
</html>